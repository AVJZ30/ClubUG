<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Integral de Farmacias del Ecuador</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- ... aquí irían tus estilos (omito por brevedad) ... -->
</head>
<body>
  <!-- HEADER, TABS, CONTENIDO, FOOTER (idéntico a tu plantilla original) -->
  <!-- ... -->
  <script>
    // ---------- Datos ----------
    const knowledgeBase = { /* igual que antes */ };
    const medications = [ /* igual que antes */ ];
    const pharmacies = { /* igual que antes */ };

    // ---------- Funciones de UI ----------
    function openTab(tabId) {
      // activar pestaña
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', tab.getAttribute('onclick').includes(tabId));
      });
      // mostrar contenido
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === tabId);
      });
    }

    function toggleProvince(prov) {
      const section = document.getElementById(prov);
      const arrow = section.previousElementSibling.querySelector('span');
      const isOpen = section.style.display === 'block';
      if (!isOpen) {
        // cargar farmacia la primera vez
        if (!section.dataset.loaded) {
          const list = section.querySelector('.pharmacy-list');
          pharmacies[prov].forEach(f => {
            const card = document.createElement('div');
            card.className = 'pharmacy-card';
            card.innerHTML = `
              <div class="pharmacy-name"><i class="fas fa-clinic-medical"></i> ${f.name}</div>
              <div class="pharmacy-info"><i class="fas fa-map-marker-alt"></i> ${f.address}</div>
              <div class="pharmacy-info"><i class="fas fa-phone"></i> ${f.phone}</div>
              <div class="pharmacy-info"><i class="fas fa-clock"></i> ${f.schedule}</div>
              <div class="pharmacy-info ${f.status==='open'?'status-open':'status-closed'}">
                ${f.status==='open'?'Abierto':'Cerrado'}
              </div>
              <div class="medication-section">
                <div class="medication-title"><i class="fas fa-pills"></i> Medicamentos Disponibles</div>
                ${f.medications.map(m=>`
                  <div class="medication-item">
                    <span>${m.name}</span>
                    <span class="medication-price">${m.price}</span>
                  </div>
                `).join('')}
              </div>
            `;
            list.appendChild(card);
          });
          section.dataset.loaded = true;
        }
        section.style.display = 'block';
        arrow.textContent = '▲';
      } else {
        section.style.display = 'none';
        arrow.textContent = '▼';
      }
    }

    function searchMedications() {
      const query = document.getElementById('medication-search').value.toLowerCase();
      const container = document.getElementById('medications-list');
      container.innerHTML = '';
      medications
        .filter(m => m.name.toLowerCase().includes(query) 
                  || m.type.toLowerCase().includes(query)
                  || m.uses.toLowerCase().includes(query))
        .forEach(m => {
          const card = document.createElement('div');
          card.className = 'medication-card';
          card.innerHTML = `
            <div class="medication-name"><i class="fas fa-pills"></i> ${m.name}</div>
            <div class="medication-details"><strong>Tipo:</strong> ${m.type}</div>
            <div class="medication-details"><strong>Presentación:</strong> ${m.presentation}</div>
            <div class="medication-details"><strong>Precio:</strong> ${m.price}</div>
            <div class="medication-details"><strong>Dosificación:</strong> ${m.dosage}</div>
            <div class="medication-uses"><strong>Usos:</strong> ${m.uses}</div>
          `;
          container.appendChild(card);
        });
    }

    // ---------- Chatbot ----------
    function quickQuestion(q) {
      document.getElementById('user-input').value = q;
      sendMessage();
    }

    function handleKeyPress(e) {
      if (e.key === 'Enter') sendMessage();
    }

    function getBotResponse(message) {
      const key = message.toLowerCase().trim();
      // buscar coincidencia exacta
      if (knowledgeBase[key]) {
        return knowledgeBase[key].response;
      }
      // buscar palabra clave
      for (let k in knowledgeBase) {
        if (key.includes(k) && k !== 'default') {
          return knowledgeBase[k].response;
        }
      }
      return knowledgeBase.default.response;
    }

    function sendMessage() {
      const input = document.getElementById('user-input');
      const text = input.value.trim();
      if (!text) return;
      displayMessage(text, 'user');
      input.value = '';
      showTypingIndicator();
      setTimeout(() => {
        removeTypingIndicator();
        const botResp = getBotResponse(text);
        displayMessage(botResp, 'bot');
      }, 800);
    }

    // ---------- Helpers de Chat ----------
    function displayMessage(msg, sender) {
      const chat = document.getElementById('chat-messages');
      const div = document.createElement('div');
      div.className = `message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
      div.innerHTML = sender === 'bot'
        ? `<strong>Asistente Farmacéutico:</strong> ${msg}`
        : msg;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function showTypingIndicator() {
      const chat = document.getElementById('chat-messages');
      const div = document.createElement('div');
      div.className = 'typing-indicator';
      div.id = 'typing-indicator';
      div.innerHTML = '<span></span><span></span><span></span>';
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeTypingIndicator() {
      const ind = document.getElementById('typing-indicator');
      if (ind) ind.remove();
    }

    // ---------- Inicialización ----------
    document.addEventListener('DOMContentLoaded', () => {
      // Carga inicial de medicamentos completos
      searchMedications();
    });
  </script>
</body>
</html>
